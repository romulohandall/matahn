{% extends "layout.html" %}
{% block body %}
<body>

    <div id="map-canvas-wrapper">
    <div id="map-canvas"></div>
    </div>

    <a href="#" id="olZoomInLink" class="square-button button-right zoomin-button">
        <span><i class="fa fa-plus"></i></span>
    </a>
    <a href="#" id="olZoomOutLink" class="square-button button-right zoomout-button">
        <span><i class="fa fa-minus"></i></span>
    </a>

    <a href="#" id="baselayer-button" class="square-button button-right baselayer-button">
        <span><i class="fa fa-retweet"></i></span>
    </a>

    <a href="#" id="menuLink" class="square-button menu-link">
        <span><i class="fa fa-chevron-right"></i></span>
    </a>

    <div class="overlay-wrapper scroll">
        <div class="overlay scroll">

            {% if task is defined %}
                {% if status == 'okay' %}
                    <h2 class='task-status'><i class="fa fa-check-circle"></i> Ready to download</h2>
                    <p>Your is kept for 24 hours. But, you can always make a <a href="{{ url_for('matahn') }}">new request</a>.</p>
                    <a class="pure-button button-download" href="{{download_url}}">
                        <i class="fa fa-download"></i>
                        Download
                    </a>
                {% elif status == 'deleted' %}
                    <h2 class='task-status'><i class="fa fa-exclamation-triangle"></i> File not found</h2>
                    <p>Your file has probably been deleted automatically after 24 hours. You can make a new <a href="{{ url_for('matahn') }}">request</a>.</p>
                {% else %}
                    <h2 class='task-status'><i class="fa fa-cog fa-spin"></i> Processing...</h2>
                    <p>We succesfully received you request and it is being processed now. You'll receive an email when your file is ready.</p>
                    <p>You can safely leave this window, maybe to make a <a href="{{ url_for('matahn') }}">new request</a>.</p>
                {% endif %}
                    <h2 class='task-status'><i class="fa fa-info-circle"></i> Task summary</h2>
                    <form class="pure-form pure-form-stacked">
                        Geometry of selection (WKT)
                        <input type="text" value="{{task['wkt']}}" readonly>
                        
                        AHN2 class
                        {% if task['ahn2_class'] == 'g' %}
                        <input type="text" value="gefilterd" readonly>
                        {% elif task['ahn2_class'] == 'u' %}
                        <input type="text" value="uitgefilterd" readonly>
                        {% else %}
                        <input type="text" value="gefilterd + uitgefilterd" readonly>
                        {% endif %}
                        
                        {% if status == 'okay' %}
                        Number of points
                        <input type="text" value="{{task['log_actual_point_count']}}" readonly>
                        {% endif %}
                    </form>

            {% else %}
                <div id="errorBox" style="display:none">
                    <p><i class="fa fa-exclamation-triangle"></i> Form can not be submitted</p>
                    <p class='wronginput'></p>
                </div>
                <form id="submit-task" class="pure-form pure-form-stacked">
                    
                    <button type="button" class="pure-button pure-button-primary" id="draw-rectangle"><i class="fa fa-crop"></i> Draw selection</button>
                    <p class='ptcountest'></p>

                    <fieldset>
                        <label for="classificationSelector">Classification</label>
                        <select name="classificationSelector">
                            <option value="g">ground (gefilterd)</option>
                            <option value="u">man-made (uitgefilterd)</option>
                            <option value="ug">both</option>
                        </select>

                        <label for="simplificationSelector" disabled>Thinning (coming soon)</label>
                        <select name="simplificationSelector" disabled>
                            <option value="t">nth point</option>
                            <option value="mat">MAT-based</option>
                        </select>
                        
                        <label for="email">Email</label>
                        <input name="useremail" type="email" autocomplete="on" placeholder="Your Email">
                        <button type="submit" id="submit-button" class="pure-button">Submit</button>
                    </fieldset>
                </form>
                <h2 class="task-status"><i class="fa fa-info-circle"></i> Notes</h2>
                <div id='intro'>
                    <ul>
                        <li>Only raw <a href='http://www.ahn.nl'>AHN2</a> points-clouds can be downloaded, no grids</li>
                        <li>Blue regions indicate what parts of AHN2 we currently offer</li>
                        <li>~{{max_point_query_size}} points per request are allowed</li>
                        <li>Output in <a href='http://www.laszip.org'>LAZ format</a></li>
                    </ul>
                </div>
            {% endif %}
        </div>

    </div>
    <script type=text/javascript>
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
      {% if task is defined %}
      $TASK_ID = '{{task['id']}}';
      {% else %}
      $TASK_ID = undefined;
      {% endif %}
    </script>
    <script src="http://tiles.geocoders.nl/api/ol/2.12/OpenLayers.js"></script>
    <script src="http://tiles.geocoders.nl/lib/proj4js/proj4js-compressed.js"></script>
    <script src="{{ url_for('static', filename='js/third_party/jquery-1.11.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
{% endblock %}