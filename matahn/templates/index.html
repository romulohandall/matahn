{% extends "layout.html" %}
{% block body %}
<body>

    <div id="map-canvas-wrapper">
    <div id="map-canvas"></div>
    </div>

    <a href="#" id="olZoomInLink" class="square-button button-right zoomin-button">
        <span><i class="fa fa-plus"></i></span>
    </a>
    <a href="#" id="olZoomOutLink" class="square-button button-right zoomout-button">
        <span><i class="fa fa-minus"></i></span>
    </a>

    <a href="#" id="baselayer-button" class="square-button button-right baselayer-button">
        <span><i class="fa fa-retweet"></i></span>
    </a>

    <a href="#" id="menuLink" class="square-button menu-link">
        <span><i class="fa fa-chevron-right"></i></span>
    </a>

    <div class="overlay-wrapper">
        <div class="overlay">

            {% if task is defined %}
                {% if status == 'okay' %}
                    <p class='task-status'><i class="fa fa-check-circle"></i> Ready to download</p>
                    <p>Please note that your file will be deleted after 24 hours.</p>
                    <a class="pure-button button-download" href="{{download_url}}">
                        <i class="fa fa-download"></i>
                        Download
                    </a>
                {% elif status == 'deleted' %}
                    <p class='task-status'><i class="fa fa-exclamation-triangle"></i> File not found</p>
                    <p>Your file has probably been deleted automatically after 24 hours. You can make a new <a href="{{ url_for('matahn') }}">request</a>.</p>
                {% else %}
                    <p class='task-status'><i class="fa fa-cog fa-spin"></i> Processing...</p>
                    <p>You'll receive an email when your file is ready. You can safely close this window.</p>
                {% endif %}
                    <p class='task-status'><i class="fa fa-info-circle"></i> Task summary</p>
                    <form class="pure-form pure-form-stacked">
                        Geometry (EWKT)
                        <input type="text" value="{{task['ewkt']}}" readonly>
                        AHN2 class
                        <input type="text" value="{{task['ahn2_class']}}" readonly>
                        {% if status == 'okay' %}
                        Execution time (s)
                        <input type="text" value="{{task['log_execution_time']}}" readonly>
                        Actual point count
                        <input type="text" value="{{task['log_actual_point_count']}}" readonly>
                        {% endif %}
                    </form>

            {% else %}
                <div id='intro'>
                    <p>Through this system you can easily download square pieces of <a href='http://www.ahn.nl'>AHN2</a>. Please take the follwing remarks into considerations:</p>
                    <ul>
                     <li>currently only queries of up to ~{{max_point_query_size}} points are allowed.</li>
                     <li>the blue regions indicate what part of AHN2 is currently available through this system.</li>
                     <li>your points will be delivered in the <a href='http://www.laszip.org'>laz format</a>.</li>
                    </ul>
                </div>
                <form id="submit-task" class="pure-form pure-form-stacked">
                    
                    <button type="button" class="pure-button pure-button-primary" id="draw-rectangle"><i class="fa fa-crop"></i> Draw selection</button>
                    <p class='ptcountest'></p>

                    <fieldset>
                        <!-- <legend>Make your request</legend> -->

                        <label for="classificationSelector">Classification</label>
                        <select name="classificationSelector">
                            <option value="g">ground (gefilterd)</option>
                            <option value="u">man-made (uitgefilterd)</option>
                            <option value="ug">both</option>
                        </select>

                        <label for="simplificationSelector" disabled>Thinning (coming soon)</label>
                        <select name="simplificationSelector" disabled>
                            <option value="t">nth point</option>
                            <option value="mat">MAT-based</option>
                        </select>
                        
                        <label for="email">Email</label>
                        <input name="useremail" type="email" autocomplete="on" placeholder="Your Email">
                        <button type="submit" id="submit-button" class="pure-button">Submit</button>
                    </fieldset>
                </form>
                <div id="errorBox" style="display:none">
                    <p><i class="fa fa-exclamation-triangle"></i> Form can not be submitted</p>
                    <p class='wronginput'></p>
                </div>
            {% endif %}
        </div>

    </div>
    <script type=text/javascript>
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
      {% if task is defined %}
      $TASK_ID = '{{task['id']}}';
      {% else %}
      $TASK_ID = undefined;
      {% endif %}
    </script>
    <script src="http://tiles.geocoders.nl/api/ol/2.12/OpenLayers.js"></script>
    <script src="http://tiles.geocoders.nl/lib/proj4js/proj4js-compressed.js"></script>
    <script src="{{ url_for('static', filename='js/third_party/jquery-1.11.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
{% endblock %}